<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Ticketing Pro + Analytics</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #166e48 0%, #0d4d32 100%);
            --sidebar-bg: #ffffff;
            --main-bg: #f0f4f3; 
            --card-shadow: 0 10px 25px rgba(0,0,0,0.05);
            --accent-color: #166e48;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--main-bg);
            margin: 0;
            display: flex;
            height: 100vh;
            color: #444;
        }

        .sidebar {
            width: 260px;
            background-color: var(--sidebar-bg);
            border-right: 1px solid rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            padding: 30px 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.02);
            z-index: 10;
        }

        .logo-container { text-align: center; margin-bottom: 40px; }
        .nav-menu { list-style: none; padding: 0; margin: 0; }
        .nav-menu li {
            padding: 14px 18px;
            margin-bottom: 8px;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 400;
            color: #666;
        }

        .nav-menu li:hover { background-color: #f5f9f7; color: var(--accent-color); }
        .nav-menu li.active {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(22, 110, 72, 0.3);
        }

        .main-content { flex: 1; padding: 40px; overflow-y: auto; }

        .card {
            background: white;
            padding: 35px;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            max-width: 950px;
            margin: 0 auto 30px auto;
        }

        h2 { 
            color: #1a1a1a; 
            margin-bottom: 25px; 
            font-weight: 400; 
            border-left: 4px solid var(--accent-color);
            padding-left: 15px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            max-width: 950px;
            margin-left: auto;
            margin-right: auto;
        }

        .chart-card {
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            height: 300px;
        }

        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 400; color: #777; font-size: 14px; }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1.5px solid #eee;
            border-radius: 10px;
            box-sizing: border-box;
            background-color: #fafafa;
            font-family: inherit;
        }

        button {
            background: var(--primary-gradient);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn-pdf { background: #d9534f; margin-left: 10px; }
        .btn-excel { background: #217346; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 16px; text-align: left; border-bottom: 1px solid #f0f0f0; font-weight: 400; }
        th { background-color: #fafafa; color: #888; font-size: 13px; }

        .row-number {
            font-weight: 600;
            color: var(--accent-color);
            background-color: #f9f9f9;
            width: 40px;
            text-align: center;
        }

        .icon-btn { background: none; color: #888; padding: 8px; border-radius: 50%; cursor: pointer; border:none; }
        .icon-btn.delete:hover { color: #d9534f; background-color: #fdf2f2; }
        .icon-btn.view:hover { color: #007bff; background-color: #f0f7ff; }

        .preview-img { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; margin-top: 10px; }
        .header-with-btn {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    border-left: 4px solid var(--accent-color);
    padding-left: 15px;
}

.copy-btn {
    background: #eee;
    color: #666;
    border: none;
    padding: 5px 10px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: 0.3s;
}
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo-container">
            <img src="https://i.postimg.cc/Y98Km4rh/Whats-App-Image-2026-01-22-at-14-13-49.png" width="160" alt="HAKA Logo">
        </div>
        <ul class="nav-menu">
            <li class="active" onclick="showPage('form-page')">
                <span class="material-icons-outlined">add_task</span> Submit Ticket
            </li>
            <li onclick="showPage('admin-page')">
                <span class="material-icons-outlined">dashboard</span> Admin Dashboard
            </li>
        </ul>
    </div>

    <div class="main-content">
        <div id="form-page" class="card">
            <div class="header-with-btn">
                <h2>New IT Support Ticket</h2>
                <button class="copy-btn" onclick="copyFormLink()">
                    <span class="material-icons-outlined" style="font-size: 16px;">content_copy</span> Copy Link
                </button>
            </div>            <form id="ticketForm">
                <div class="form-group">
                    <label>Company</label>
                    <select id="companyName" required>
                        <option value=""> please Select </option>
                        <option value="Rikaz">Rikaz</option>
                        <option value="zaya">zaya</option>
                        <option value="Fadeco">Fadeco</option>
                        <option value="HFI">HFI</option>
                        <option value="GH Transport">GH Transport</option>
                        <option value="Haka resources">Haka resources</option>
                        <option value="Haka Properties">Haka Properties</option>
                        <option value="GIMA">GIMA</option>
                        <option value="azdan">azdan</option>
                        <option value="salyl">salyl</option>
                        <option value="Haka foundation">Haka foundation</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Employee Name</label>
                    <select id="empName" required>
                        <option value="">Select Name</option>
                        <option value="Saad Al-Howail">Saad Al-Howail</option>
                        <option value="Shatha Al-Shammari">Shatha Al-Shammari</option>
                        <option value="Ahmed Al-Sulaiteen">Ahmed Al-Sulaiteen</option>
                        <option value="Meshari Shifloot">Meshari Shifloot</option>
                        <option value="Sarah Al-Damer">Sarah Al-Damer</option>
                        <option value="Fajer Al-Mutairi">Fajer Al-Mutairi</option>
                    </select>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>Department</label>
                        <select id="dept">
                            <option value="Finance">Finance</option>
                            <option value="IT">IT</option>
                            <option value="CC">CC</option>
                            <option value="Operation">Operation</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Sales">Sales</option>
                            <option value="Admin">Admin</option>
                            <option value="Logistics">Logistics</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="formStatus">
                            <option value="Done">Done</option>
                            <option value="Incomplete">Incomplete</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Issue Description / Details</label>
                    <textarea id="desc" rows="4" placeholder="Please describe the issue in detail..."></textarea>
                </div>

                <div class="form-group">
                    <label>Attachments</label>
                    <input type="file" id="fileAttachment" multiple accept="image/*" onchange="previewFiles()">
                    <div id="preview-container"></div>
                </div>

                <button type="submit">Submit Request</button>
            </form>
        </div>

        <div id="admin-page" style="display:none;">
            <div class="dashboard-grid">
                <div class="chart-card">
                    <h3 style="font-weight: 400; margin-top: 0; font-size: 16px;">Tickets per Company</h3>
                    <canvas id="companyChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3 style="font-weight: 400; margin-top: 0; font-size: 16px;">Department Distribution</h3>
                    <canvas id="deptChart"></canvas>
                </div>
            </div>

            <div class="card" style="max-width: 1150px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Tickets Overview</h2>
                    <div>
                        <button onclick="exportToExcel()" class="btn-excel"><span class="material-icons-outlined">table_view</span> Excel</button>
                        <button onclick="exportToPDF()" class="btn-pdf"><span class="material-icons-outlined">picture_as_pdf</span> PDF</button>
                    </div>
                </div>
                <div style="overflow-x: auto;">
                    <table id="ticketTable">
                        <thead>
                            <tr>
                                <th style="width: 40px;">#</th>
                                <th>Company</th>
                                <th>Employee</th>
                                <th>Dept</th>
                                <th>Status</th>
                                <th>Created At</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ticketTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        function copyFormLink() {
    const url = window.location.href; // يأخذ رابط الصفحة الحالي
    navigator.clipboard.writeText(url).then(() => {
        alert("Form link copied to clipboard!"); // تنبيه للمستخدم بنجاح النسخ
    }).catch(err => {
        console.error('Error: ', err);
    });
}
        let tickets = [];
        let currentFiles = [];
        let companyChartInstance = null;
        let deptChartInstance = null;

        function showPage(pageId) {
    if (pageId === 'admin-page') {
        const password = prompt("Please enter Admin Password:");
        if (password !== "123456654321") { // password
            alert("Incorrect password!");
            return;
        }
    }

    document.getElementById('form-page').style.display = pageId === 'form-page' ? 'block' : 'none';
    document.getElementById('admin-page').style.display = pageId === 'admin-page' ? 'block' : 'none';
    
    document.querySelectorAll('.nav-menu li').forEach(li => li.classList.remove('active'));
    if(window.event) window.event.currentTarget.classList.add('active');
    
    if(pageId === 'admin-page') {
        renderTable();
        updateDashboard();
    }
}

        function updateDashboard() {
            const compData = {};
            const deptData = {};

            tickets.forEach(t => {
                compData[t.company] = (compData[t.company] || 0) + 1;
                deptData[t.dept] = (deptData[t.dept] || 0) + 1;
            });

      
            const ctxComp = document.getElementById('companyChart').getContext('2d');
            if(companyChartInstance) companyChartInstance.destroy();
            companyChartInstance = new Chart(ctxComp, {
                type: 'bar',
                data: {
                    labels: Object.keys(compData),
                    datasets: [{
                        label: 'Tickets',
                        data: Object.values(compData),
                        backgroundColor: ['#166e48', '#2d8a5a', '#4fac7d', '#8ed1af'],
                        borderRadius: 5
                    }]
                },
                options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });

           
            const ctxDept = document.getElementById('deptChart').getContext('2d');
            if(deptChartInstance) deptChartInstance.destroy();
            deptChartInstance = new Chart(ctxDept, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(deptData),
                    datasets: [{
                        data: Object.values(deptData),
                        backgroundColor: ['#166e48', '#2d8a5a', '#4fac7d', '#8ed1af']
                    }]
                },
                options: { maintainAspectRatio: false }
            });
        }

        function previewFiles() {
            const preview = document.getElementById('preview-container');
            preview.innerHTML = '';
            currentFiles = [];
            Array.from(document.getElementById('fileAttachment').files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    currentFiles.push(e.target.result);
                    const img = document.createElement('img');
                    img.src = e.target.result; img.className = 'preview-img';
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        }

        document.getElementById('ticketForm').onsubmit = function(e) {
            e.preventDefault();
            const now = new Date();
            const timestamp = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            const newTicket = {
                id: Date.now(),
                company: document.getElementById('companyName').value,
                name: document.getElementById('empName').value,
                dept: document.getElementById('dept').value,
                status: document.getElementById('formStatus').value,
                desc: document.getElementById('desc').value,
                createdAt: timestamp,
                images: [...currentFiles]
            };
            tickets.push(newTicket);
            alert('Ticket Submitted!');
            this.reset();
            document.getElementById('preview-container').innerHTML = '';
        };

        function renderTable() {
            const tbody = document.getElementById('ticketTableBody');
            tbody.innerHTML = '';
            tickets.forEach((t, index) => {
                tbody.innerHTML += `
                    <tr>
                        <td class="row-number">${index + 1}</td>
                        <td>${t.company}</td>
                        <td>${t.name}</td>
                        <td>${t.dept}</td>
                        <td style="color: ${t.status === 'Done' ? '#166e48' : '#d9534f'}">${t.status}</td>
                        <td style="font-size: 12px; color: #999;">${t.createdAt}</td>
                        <td>
                            <button class="icon-btn view" onclick="viewFiles(${t.id})"><span class="material-icons-outlined">visibility</span></button>
                            <button class="icon-btn delete" onclick="deleteTicket(${t.id})"><span class="material-icons-outlined">delete</span></button>
                        </td>
                    </tr>
                `;
            });
        }

        function viewFiles(id) {
            const t = tickets.find(x => x.id === id);
            const win = window.open("");
            win.document.write("<h3>Attachments:</h3>");
            t.images.forEach(img => win.document.write(`<img src="${img}" style="width:250px; margin:10px; border-radius:8px;">`));
        }

        function deleteTicket(id) {
            if(confirm("Delete?")) { 
                tickets = tickets.filter(x => x.id !== id); 
                renderTable(); 
                updateDashboard();
            }
        }

        function exportToExcel() {
            let csv = "ID,Company,Employee,Dept,Status,Created At\n";
            tickets.forEach((t, index) => csv += `${index + 1},${t.company},${t.name},${t.dept},${t.status},${t.createdAt}\n`);
            const link = document.createElement("a");
            link.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
            link.download = "it_report.csv"; link.click();
        }

        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text("IT Support Report", 14, 15);
            const tableRows = tickets.map((t, index) => [index + 1, t.company, t.name, t.dept, t.status, t.createdAt]);
            doc.autoTable({
                head: [['#', 'Company', 'Employee', 'Department', 'Status', 'Date']],
                body: tableRows,
                startY: 20,
            });
            doc.save("it_report.pdf");
        }
    </script>
</body>
</html>
